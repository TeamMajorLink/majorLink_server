<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notification Example</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        #notifications {
            list-style-type: none;
            padding: 0;
        }
        #notifications li {
            background-color: #f9f9f9;
            margin: 5px 0;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 3px;
        }
    </style>
</head>
<body>
<h1>Notifications</h1>
<ul id="notifications"></ul>

<script>
    // 인증 토큰 (서버와 통신하기 전에 실제 토큰을 얻는 방법으로 대체)
    const authToken = 'eyJhbGciOiJIUzI1NiJ9.eyJleHAiOjE3MjY2NDgxMDEsInN1YiI6ImFjY2Vzcy10b2tlbiIsInV1aWQiOiIzNWQ5YTllMy0wYTJmLTRmOTQtOGEzNS1lOWNjMWYzOGFiOTEiLCJpYXQiOjE3MjQwNTYxMDF9.Wge95Vu_pT228EfmsNdQZTtiGYFnSlaz4AatIDjVZQA';

    // SSE 연결 생성
    const eventSource = new EventSource(`http://localhost:8080/subscribe?token=${authToken}`);

    // 이벤트 수신 처리
    eventSource.onmessage = function(event) {
        // 서버에서 받은 메시지 처리
        const newNotification = JSON.parse(event.data);
        displayNotification(newNotification);
    };

    // 오류 처리
    eventSource.onerror = function(error) {
        console.error('EventSource failed:', error);
    };

    // 새 알림 표시 함수
    function displayNotification(notification) {
        const notificationsList = document.getElementById('notifications');
        const newItem = document.createElement('li');
        newItem.textContent = notification.message;
        notificationsList.appendChild(newItem);
    }

    // 페이지 언마운트 시 SSE 닫기
    window.addEventListener('beforeunload', () => {
        eventSource.close();
    });
</script>
</body>
</html>
